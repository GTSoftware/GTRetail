<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:gtsoftware="http://java.sun.com/jsf/composite/gtsoftware"
    xmlns:f="http://java.sun.com/jsf/core"
    template="/WEB-INF/templates/template.xhtml">


    <ui:define name="meta">

        <f:metadata >

            <f:event listener="#{verVentasBean.init()}"
                     type="preRenderView">
            </f:event>

        </f:metadata>

    </ui:define>

    <!-- Contenido -->
    <ui:define name="content">
        <ui:insert >
            <ui:include src="breadcrumb.xhtml" />
        </ui:insert>

        <h:form id="opcionesForm" >
            <p:panel header="#{msg.acciones}">
                <!-- Facturar-->
                <p:commandButton id="facturarButton"
                                 value="#{msg.facturar}"
                                 icon="ui-icon-print"
                                 rendered="#{empty verVentasBean.ventaActual.idRegistroIva}"
                                 update=":facturarForm:facturarDialog"
                                 oncomplete="PF('facturarDialog').show()"
                                 process="@none"
                                 />
                <!-- Imprimir factura -->
                <p:commandButton id="imprimirFacturaButton"
                                 value="#{msg.imprimirFactura}"
                                 icon="ui-icon-print"
                                 rendered="#{not empty verVentasBean.ventaActual.idRegistroIva}"
                                 action="#{impresionVentasBean.imprimirFactura(verVentasBean.ventaActual)}"
                                 ajax="false"
                                 />
                <!-- Imprimir presupuesto -->
                <p:commandButton value="#{msg.presupuesto}"
                                 icon="ui-icon-print"
                                 action="#{impresionVentasBean.imprimirPresupuesto(verVentasBean.ventaActual)}"
                                 ajax="false"
                                 />
                <!-- Anular factura -->
                <p:commandButton value="#{msg.anularFactura}"
                                 icon="ui-icon-cancel"
                                 rendered="#{not empty verVentasBean.ventaActual.idRegistroIva}"
                                 onclick="PF('confirmation').show()"
                                 >

                </p:commandButton>
                <!-- Anular Venta -->
                <p:commandButton value="#{msg.anularVenta}"
                                 icon="ui-icon-cancel"
                                 rendered="#{verVentasBean.ventaActual.idRegistroIva eq null}"
                                 onclick="PF('confirmationAnularVenta').show()"
                                 >

                </p:commandButton>
                <!-- Cuadro de confirmación para Anular factura -->
                <p:confirmDialog widgetVar="confirmation" header="#{msg.confirmacion}"
                                 appendTo="@(body)"
                                 message="#{msg.anularRealmente}"
                                 showEffect="fade" hideEffect="explode">


                    <p:commandButton value="#{msg.si}"
                                     oncomplete="confirmation.hide()"
                                     actionListener="#{verVentasBean.anularFactura()}"
                                     immediate="true"
                                     update=":opcionesForm"
                                     styleClass="ui-confirmdialog-yes"
                                     icon="ui-icon-check"
                                     process="@this"/>

                    <p:commandButton value="#{msg.no}" type="button"
                                     onclick="PF('confirmation').hide()"
                                     styleClass="ui-confirmdialog-no"
                                     icon="ui-icon-close" />

                </p:confirmDialog>
                <!-- Cuadro de confirmación para Anular Venta -->
                <p:confirmDialog widgetVar="confirmationAnularVenta" header="#{msg.confirmacion}"
                                 appendTo="@(body)"
                                 message="#{msg.anularRealmente}"
                                 showEffect="fade" hideEffect="explode">


                    <p:commandButton value="#{msg.si}"
                                     oncomplete="confirmationAnularVenta.hide()"
                                     actionListener="#{verVentasBean.anularVenta()}"
                                     immediate="true"
                                     update=":opcionesForm"
                                     styleClass="ui-confirmdialog-yes"
                                     icon="ui-icon-check"
                                     process="@this"/>

                    <p:commandButton value="#{msg.no}" type="button"
                                     onclick="PF('confirmationAnularVenta').hide()"
                                     styleClass="ui-confirmdialog-no"
                                     icon="ui-icon-close" />

                </p:confirmDialog>
            </p:panel>
        </h:form>

        <h:form id="facturarForm" >
            <p:dialog header="#{msg.facturar}"
                      widgetVar="facturarDialog"
                      resizable="true"
                      id="facturarDialog"
                      rendered="#{empty verVentasBean.ventaActual.idRegistroIva}"
                      closeOnEscape="true"
                      showEffect="fade"
                      hideEffect="clip"
                      modal="true">

                <p:panelGrid layout="grid"  styleClass="ui-panelgrid-blank" columns="2" >


                    <p:outputLabel for="letraFacturaField" value="#{msg.letraFactura}:"/>
                    <p:inputText id="letraFacturaField" value="#{verVentasBean.letraComprobante}" size="1" readonly="true"/>

                    <p:outputLabel for="pvFacturaField" value="#{msg.puntoVenta}:"/>


                    <p:selectOneMenu id="pvFacturaField" required="true"
                                     requiredMessage="#{msg.campoRequerido}"
                                     value="#{verVentasBean.puntoVentaSeleccionado}"
                                     converter="omnifaces.SelectItemsIndexConverter">

                        <f:selectItems value="#{verVentasBean.puntosVentaList}"
                                       var="punto"
                                       itemValue="#{punto}"
                                       itemLabel="#{punto.businessString}"/>
                    </p:selectOneMenu>

                    <!--
                                        <p:outputLabel for="nroFacturaField" value="#{msg.numero}:"/>
                                        <p:inputText id="nroFacturaField" value="#{verVentasBean.numeroComprobante}" maxlength="8"  >
                                            <f:validateLongRange minimum="1" maximum="99999999" />
                                        </p:inputText>-->
                    <!--
                                        <p:outputLabel for="fechaFacturaField" value="#{msg.fecha}:"/>
                                        <p:calendar id="fechaFacturaField" value="#{verVentasBean.fechaFactura}" navigator="true" pattern="dd/MM/yyyy HH:mm" />-->

                </p:panelGrid >

                <p:commandButton value="#{msg.ok}" icon="ui-icon-check"
                                 oncomplete="PF('facturarDialog').hide()"
                                 update=":opcionesForm"
                                 action="#{verVentasBean.registrarFactura()}"/>

            </p:dialog>


        </h:form>

        <gtsoftware:vistaVenta
            venta="#{verVentasBean.ventaActual}"
            lineasVenta="#{verVentasBean.lineasVenta}"
            >
        </gtsoftware:vistaVenta>



    </ui:define>

</ui:composition>


