<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"

      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:form id="busquedaProductosForm" >
        <p:dialog header="#{msg.busquedaProductos}"
                  widgetVar="productosDialog"
                  resizable="true"
                  id="productosDialog"
                  closeOnEscape="true"
                  showEffect="fade"
                  hideEffect="clip"
                  modal="true">
            <p:fragment>
                <h:panelGrid columns="4">
                    <p:outputLabel value="#{msg.busqueda}"/>
                    <p:inputText id="cadenaBusquedaProdField"
                                 value="#{productosSearchBean.filter.txt}"
                                 size="50"/>
                    <p:selectOneMenu id="listaField" value="#{productosSearchBean.listaSeleccionada}"
                                     required="true" requiredMessage="#{msg.seleccionarUno}"
                                     converter="#{productosListasPreciosConverter}"
                                     >

                        <f:selectItems value="#{productosSearchBean.listasPrecio}" var="lista" itemLabel="#{lista.nombreLista}"
                                       itemValue="#{lista}"/>

                    </p:selectOneMenu>
                    <p:commandButton  action="#{productosSearchBean.doSearch()}"
                                      process="@this"
                                      value="#{msg.buscar}"
                                      update="productosBusquedaTable"
                                      icon="ui-icon-search"/>
                </h:panelGrid>

                <p:separator />



                <p:dataTable id="productosBusquedaTable" var="pro" value="#{productosSearchBean.dataModel}"
                             rows="5"
                             lazy="true"
                             paginator="true"
                             emptyMessage="#{msg.busquedaSinResultados}"
                             selectionMode="single"
                             selection="#{nuevaVentaBean.lineaActual.idProducto}"
                             rowKey="#{pro.id}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15,30,100"
                             style="width: 100%"
                             resizableColumns="true"
                             scrollable="true"
                             sortMode="single">

                    <p:ajax event="rowSelect"  />

                    <p:column style="width:5%">
                        <f:facet name="header">
                            #{msg.id}
                        </f:facet>
                        <h:outputText value="#{pro.id}" />
                    </p:column>

                    <p:column  >
                        <f:facet name="header">
                            #{msg.descripcion}
                        </f:facet>
                        <h:outputText value="#{pro.descripcion}" />
                    </p:column>

                    <p:column headerText="Stock" style="text-align: right">
                        <f:facet name="header">
                            #{msg.stock}
                        </f:facet>
                        <h:outputText value="0" >
                            <f:convertNumber groupingUsed="true" type="number"/>
                        </h:outputText>
                    </p:column>

                    <p:column style="text-align: right; font-size: large; font-weight: bold ">
                        <f:facet name="header">
                            #{msg.precioUnitario}
                        </f:facet>
                        <h:outputText value="#{productosSearchBean.getPrecio(pro)}"
                                      style="font-size: medium; font-weight: bold">
                            <f:convertNumber groupingUsed="true" type="currency"
                                             currencySymbol="$"/>
                        </h:outputText>
                    </p:column>
                    <p:column  >
                        <f:facet name="header">
                            #{msg.unidadVenta}
                        </f:facet>
                        <h:outputText value="#{pro.idTipoUnidadVenta.nombreUnidad}" />
                    </p:column>


                </p:dataTable>
            </p:fragment>
            <p:commandButton value="#{msg.ok}" icon="ui-icon-check"
                             oncomplete="PF('productosDialog').hide()"
                             update=":formContenido:insertarPanel"
                             actionListener="#{nuevaVentaBean.lineaActual.setPrecioVentaUnitario(productosSearchBean.getPrecio(nuevaVentaBean.lineaActual.idProducto))}"/>
        </p:dialog>
    </h:form>
</html>

