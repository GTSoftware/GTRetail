<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <h:form id="editProductoForm">

        <p:panel id="editProductoPanel" header="#{msg.productosEdicion}" >
            <p:tabView id="editProductoTabView" >

                <p:tab title="Datos básicos" >
                    <h:panelGrid id="datosBasicosGrid" columns="3" >
                        <h:outputLabel for="idProductoField" value="#{msg.id}:"  />
                        <h:outputText id="idProductoField" value="#{productoEditBean.productosActual.id}"  />
                        <h:outputLabel/>

                        <h:outputLabel for="codigoProductoField" value="#{msg.codigo}:"  />
                        <p:inputText id="codigoProductoField" value="#{productoEditBean.productosActual.codigoPropio}"
                                     maxlength="100" required="true" requiredMessage="#{msg.ingresarValor}"
                                     label="#{msg.codigo}"/>
                        <p:message for="codigoProductoField"/>

                        <h:outputLabel for="descripcionField" value="#{msg.descripcion}:" />
                        <p:inputText id="descripcionField" value="#{productoEditBean.productosActual.descripcion}"
                                     maxlength="200"
                                     size="100"
                                     required="true" requiredMessage="#{msg.ingresarDescripcion}"
                                     converter="#{stringFormatConverter}"
                                     label="#{msg.descripcion}"/>
                        <p:message for="descripcionField"/>

                        <h:outputLabel for="observacionesField" value="#{msg.observaciones}:" />
                        <p:inputTextarea id="observacionesField" value="#{productoEditBean.productosActual.observaciones}"
                                         maxlength="2048"
                                         autoResize="true"
                                         label="#{msg.observaciones}"/>
                        <p:message for="observacionesField"/>
                    </h:panelGrid>
                </p:tab>
                <p:tab title="Clasificación" >
                    <h:panelGrid id="clasificacionGrid" columns="3" >
                        <h:outputLabel for="tipoProveeduriaField" value="#{msg.tipoProveeduria}:"/>
                        <p:selectOneMenu id="tipoProveeduriaField" value="#{productoEditBean.tiposProveeduria}"
                                         required="true" requiredMessage="#{msg.seleccionarUno}" converter="#{productosTiposProveeduriaConverter}"
                                         >
                            <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                            <f:selectItems value="#{productoEditBean.listTipoProveeduria}" var="tipoProd" itemLabel="#{tipoProd.nombreTipoProveeduria}"
                                           itemValue="#{tipoProd}"/>

                        </p:selectOneMenu>
                        <p:message for="tipoProveeduriaField"/>




                        <h:outputLabel for="rubroField" value="#{msg.productoRubro}:" />
                        <h:panelGroup >
                            <p:selectOneMenu id="rubroField"  value="#{productoEditBean.productosActual.idRubro}"
                                             valueChangeListener="#{productoEditBean.valueChanged}" converter="#{productosRubrosConverter}"
                                             label="#{msg.productoRubro}"
                                             >

                                <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                                <f:selectItems value="#{productoEditBean.listRubros}" var="rubro" itemLabel="#{rubro.nombreRubro}" itemValue="#{rubro}"/>
                                <p:ajax event="valueChange"
                                        update=":editProductoForm:editProductoTabView:subRubroPanelGroup"  process="@this"/>
                            </p:selectOneMenu>


                            <p:commandButton icon="ui-icon-plus" action="#{productoEditBean.nuevoRubro}"
                                             immediate="true" update=":nuevoRubroForm"
                                             oncomplete="PF('dlg2').show();" />
                        </h:panelGroup>
                        <p:message for="rubroField"/>


                        <h:outputLabel for="subRubroField" value="#{msg.productoSubRubro}:" />
                        <h:panelGroup id="subRubroPanelGroup">

                            <p:selectOneMenu id="subRubroField" value="#{productoEditBean.productosActual.idSubRubro}"
                                             required="true" converter="#{productosSubRubrosConverter}"
                                             requiredMessage="#{msg.seleccionarUno}"
                                             label="#{msg.productoSubRubro}"
                                             >

                                <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" />
                                <f:selectItems value="#{productoEditBean.listSubRubros}" var="subRubro"
                                               itemLabel="#{subRubro.nombreSubRubro}" itemValue="#{subRubro}"/>
                            </p:selectOneMenu>


                            <p:commandButton id="btnNuevoSubRubro" icon="ui-icon-plus" action="#{productoEditBean.nuevoSubRubro}" immediate="true"
                                             oncomplete="PF('dlgSubRubro').show();" update=":nuevoSubRubroForm"
                                             rendered="#{productoEditBean.productosActual.idRubro ne null}"/>
                        </h:panelGroup>
                        <p:message for="subRubroField"/>


                        <h:outputLabel for="marcaField" value="#{msg.marca}:" />
                        <h:panelGroup >
                            <p:selectOneMenu id="marcaField" value="#{productoEditBean.productosActual.idMarca}"
                                             required="true" requiredMessage="#{msg.ingresarValor}"
                                             converter="#{productosMarcasConverter}"
                                             label="#{msg.marca}">
                                <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                                <f:selectItems value="#{productoEditBean.listMarcas}" var="marca" itemLabel="#{marca.nombreMarca}" itemValue="#{marca}"/>

                            </p:selectOneMenu>



                            <p:commandButton id="btnNuevaMarca" icon="ui-icon-plus" action="#{productoEditBean.cargarNuevaMarca}" immediate="true"
                                             oncomplete="PF('dlgNuevaMarca').show();" update=":nuevaMarca"
                                             />
                        </h:panelGroup>
                        <p:message for="marcaField"/>



                        <h:outputLabel for="tipoUnidadCompraSelect" value="#{msg.productoTipoUnidadCompra}:"/>
                        <p:selectOneMenu id="tipoUnidadCompraSelect" value="#{productoEditBean.productosActual.idTipoUnidadCompra}"
                                         required="true" requiredMessage="#{msg.seleccionarValor}" converter="#{productosTiposUnidadesConverter}"
                                         label="#{msg.productoTipoUnidadCompra}">

                            <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                            <f:selectItems value="#{productoEditBean.listTipoUnidades}" var="tipoUnidad" itemLabel="#{tipoUnidad.nombreUnidad}"
                                           itemValue="#{tipoUnidad}"/>
                        </p:selectOneMenu>
                        <p:message for="tipoUnidadCompraSelect"/>

                        <h:outputLabel for="tipoUnidadVentaSelect" value="#{msg.productoTipoUnidadVenta}:"/>
                        <p:selectOneMenu id="tipoUnidadVentaSelect" value="#{productoEditBean.productosActual.idTipoUnidadVenta}"
                                         required="true" requiredMessage="#{msg.seleccionarValor}" converter="#{productosTiposUnidadesConverter}"
                                         label="#{msg.productoTipoUnidadVenta}">

                            <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                            <f:selectItems value="#{productoEditBean.listTipoUnidades}" var="tipoUnidad" itemLabel="#{tipoUnidad.nombreUnidad}"
                                           itemValue="#{tipoUnidad}"/>
                        </p:selectOneMenu>
                        <p:message for="tipoUnidadCompraSelect"/>

                        <h:outputLabel for="ubicacionField" value="#{msg.ubicacion}:"/>
                        <p:inputText id="ubicacionField" value="#{productoEditBean.productosActual.ubicacion}"
                                     converter="#{stringFormatConverter}"/>
                        <p:message for="ubicacionField"/>
                    </h:panelGrid>
                </p:tab>
                <p:tab title="Precio">
                    <h:panelGrid id="precioGrid" columns="3" >

                        <h:outputLabel for="costoAdquisicionField" value="#{msg.costoAdquisicion}:" />
                        <p:inputText id="costoAdquisicionField" value="#{productoEditBean.productosActual.costoAdquisicionNeto}"
                                     required="true" requiredMessage="#{msg.ingresarValor}"
                                     style="text-align: right"
                                     label="#{msg.costoAdquisicion}">
                            <f:convertNumber groupingUsed="true" maxFractionDigits="4" type="number"/>
                        </p:inputText>
                        <p:message for="costoAdquisicionField"/>

                        <!--Aca iría una lista desplegable con el tipo de porcentaje y un input para el valor -->

                        <h:outputLabel for="alicuotaIVAField" value="#{msg.alicuotaIVA}:"/>
                        <p:selectOneMenu id="alicuotaIVAField" value="#{productoEditBean.productosActual.idAlicuotaIva}" required="true"
                                         requiredMessage="#{msg.seleccionarValor}" converter="#{fiscalAlicuotaIVAConverter}"
                                         label="#{msg.alicuotaIVA}">
                            <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" />
                            <f:selectItems value="#{productoEditBean.listAlicuotaIVA}" var="alicuota"
                                           itemLabel="#{alicuota.nombreAlicuotaIva}" itemValue="#{alicuota}" />

                        </p:selectOneMenu>
                        <p:message for="alicuotaIVAField"/>

                        <h:outputLabel for="utilidadField" value="#{msg.productosUtilidad}:"/>
                        <p:inputText id="utilidadField" value="#{productoEditBean.productosActual.utilidad}"
                                     label="#{msg.productosUtilidad}"
                                     style="text-align: right">
                            <f:convertNumber maxFractionDigits="4"
                                             groupingUsed="true"
                                             type="number"/>

                        </p:inputText>
                        <p:message for="utilidadField"/>

                        <h:outputLabel for="precioVentaField" value="#{msg.precioVenta}:" />
                        <p:inputText id="precioVentaField" value="#{productoEditBean.productosActual.precioVenta}"
                                     required="true" requiredMessage="#{msg.ingresarValor}"
                                     label="#{msg.precioVenta}"
                                     style="text-align: right"/>
                        <p:message for="precioVentaField"/>
                    </h:panelGrid>
                </p:tab>
                <p:tab title="Proveedor y stock">
                    <h:panelGrid id="proveedorGrid" columns="3" >
                        <h:outputLabel for="stockField" value="#{msg.stock}:"/>
                        <p:inputText id="stockField" value="#{productoEditBean.productosActual.stockTotal}" required="true"
                                     requiredMessage="#{msg.ingresarValor}" >
                            <f:convertNumber  maxIntegerDigits="8"
                                              maxFractionDigits="2"/>
                        </p:inputText>
                        <p:message for="stockField"/>

                        <h:outputLabel for="proveedorHabitualField" value="#{msg.proveedor}:"/>
                        <p:selectOneMenu id="proveedorHabitualField" value="#{productoEditBean.productosActual.idProveedorHabitual}"
                                         converter="#{personasConverter}"
                                         required="false" requiredMessage="#{msg.seleccionarUno}">
                            <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                            <f:selectItems value="#{productoEditBean.listProveedores}" var="proveedor"
                                           itemLabel="#{proveedor.nombreFantasia}"
                                           itemValue="#{proveedor}"/>

                        </p:selectOneMenu>
                        <p:message for="proveedorHabitualField"/>

                    </h:panelGrid>
                </p:tab>
            </p:tabView>

            <h:panelGrid columns="2" >
                <p:commandButton id="guardarButton"
                                 value="#{msg.guardar}"
                                 icon="ui-icon-disk"
                                 action="#{productoEditBean.doGuardar}"
                                 update="@form"
                                 ajax="true"
                                 />

                <p:commandButton id="cancelarButton"
                                 value="#{msg.cancelar}"
                                 icon="ui-icon-cancel"
                                 action="/protected/productos/consultarProductos.xhtml?faces-redirect=true"
                                 immediate="true"
                                 ajax="false" />
            </h:panelGrid>

        </p:panel>
    </h:form>

    <h:form id="nuevoRubroForm">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlg2"  height="100">


            <h:panelGrid columns="3">


                <h:outputLabel for="descripcionRubroField" value="#{msg.productoRubro}:" />
                <p:inputText id="descripcionRubroField" value="#{productoEditBean.productosRubrosNuevo.nombreRubro}"
                             required="true" requiredMessage="#{msg.ingresarValor}"/>
                <p:message for="descripcionRubroField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarRubro}"
                                  update=":editProductoForm:editProductoTabView:rubroField" onclick="PF('dlg2').hide();" />



            </h:panelGrid>
        </p:dialog>
    </h:form>


    <h:form id="nuevoSubRubroForm">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlgSubRubro"  height="100">

            <h:panelGrid columns="2">

                <h:outputLabel for="descripcionRubro" value="#{msg.productoRubro}:" />
                <h:outputText  id="descripcionRubro" value="#{productoEditBean.productosSubRubrosNuevo.idRubro.nombreRubro}"
                               />
            </h:panelGrid>

            <h:panelGrid columns="3" >

                <h:outputLabel for="descripcionSubRubroField" value="#{msg.productoSubRubro}:" />
                <p:inputText id="descripcionSubRubroField" value="#{productoEditBean.productosSubRubrosNuevo.nombreSubRubro}"
                             required="true" requiredMessage="#{msg.ingresarValor}"
                             converter="#{stringFormatConverter}"/>
                <p:message for="descripcionSubRubroField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarSubRubro}"
                                  update=":editProductoForm:editProductoTabView:subRubroField" onclick="PF('dlgSubRubro').hide();"/>

            </h:panelGrid>
        </p:dialog>
    </h:form>

    <h:form id="nuevaMarca">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlgNuevaMarca"  height="100">



            <h:panelGrid columns="3" >

                <h:outputLabel for="nombreMarcaField" value="#{msg.marca}:" />
                <p:inputText id="nombreMarcaField" value="#{productoEditBean.nuevaMarca.nombreMarca}"
                             required="true" requiredMessage="#{msg.ingresarValor}"
                             converter="#{stringFormatConverter}"/>
                <p:message for="nombreMarcaField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarMarca}"
                                  update=":editProductoForm:editProductoTabView:marcaField" onclick="PF('dlgNuevaMarca').hide();"/>

            </h:panelGrid>
        </p:dialog>
    </h:form>


</html>
