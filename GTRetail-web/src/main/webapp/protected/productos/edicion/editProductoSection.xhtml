<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <h:form id="editProductoForm">

        <p:panel id="editProductoPanel" header="#{msg.productosEdicion}" >

            <h:panelGrid id="editProductoGrid" columns="3" >
                <h:outputLabel for="codigoProductoField" value="#{msg.codigo}:"  />
                <p:inputText id="codigoProductoField" value="#{productoEditBean.productosActual.codigoPropio}"
                             maxlength="100" required="true" requiredMessage="#{msg.ingresarValor}"
                             label="#{msg.codigo}"/>
                <p:message for="codigoProductoField"/>

                <h:outputLabel for="descripcionField" value="#{msg.descripcion}:" />
                <p:inputText id="descripcionField" value="#{productoEditBean.productosActual.descripcion}"
                             maxlength="200"
                             required="true" requiredMessage="#{msg.ingresarDescripcion}"
                             converter="#{stringFormatConverter}"
                             label="#{msg.descripcion}"/>
                <p:message for="descripcionField"/>



                <h:outputLabel for="rubroField" value="#{msg.productoRubro}:" />
                <h:panelGroup >
                    <p:selectOneMenu id="rubroField"  value="#{productoEditBean.productosActual.idRubro}"
                                     valueChangeListener="#{productoEditBean.valueChanged}" converter="#{productosRubrosConverter}"
                                     label="#{msg.productoRubro}"
                                     >

                        <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                        <f:selectItems value="#{productoEditBean.listRubros}" var="rubro" itemLabel="#{rubro.nombreRubro}" itemValue="#{rubro}"/>
                        <p:ajax event="valueChange"
                                update=":editProductoForm:subRubroField"  process="@this"/>
                    </p:selectOneMenu>


                    <p:commandButton icon="ui-icon-plus" action="#{productoEditBean.nuevoRubro}"
                                     immediate="true" update=":nuevoRubroForm"
                                     oncomplete="PF('dlg2').show();" />
                </h:panelGroup>
                <p:message for="rubroField"/>


                <h:outputLabel for="subRubroField" value="#{msg.productoSubRubro}:" />
                <h:panelGroup>

                    <p:selectOneMenu id="subRubroField" value="#{productoEditBean.productosActual.idSubRubro}"
                                     required="true" converter="#{productosSubRubrosConverter}"
                                     requiredMessage="#{msg.seleccionarUno}"
                                     label="#{msg.productoSubRubro}"
                                     >

                        <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" />
                        <f:selectItems value="#{productoEditBean.listSubRubros}" var="subRubro"
                                       itemLabel="#{subRubro.nombreSubRubro}" itemValue="#{subRubro}"/>
                    </p:selectOneMenu>


                    <p:commandButton id="btnNuevoSubRubro" icon="ui-icon-plus" action="#{productoEditBean.nuevoSubRubro}" immediate="true"
                                     oncomplete="PF('dlgSubRubro').show();" update=":nuevoSubRubroForm"
                                     rendered="#{productoEditBean.productosRubros.nombreRubro ne null}"/>
                </h:panelGroup>
                <p:message for="subRubroField"/>


                <h:outputLabel for="marcaField" value="#{msg.marca}:" />
                <h:panelGroup >
                    <p:selectOneMenu id="marcaField" value="#{productoEditBean.productosActual.idMarca}"
                                     required="true" requiredMessage="#{msg.ingresarValor}"
                                     converter="#{productosMarcasConverter}"
                                     label="#{msg.marca}">
                        <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                        <f:selectItems value="#{productoEditBean.listMarcas}" var="marca" itemLabel="#{marca.nombreMarca}" itemValue="#{marca}"/>

                    </p:selectOneMenu>



                    <p:commandButton id="btnNuevaMarca" icon="ui-icon-plus" action="#{productoEditBean.nuevaMarca}" immediate="true"
                                     oncomplete="PF('dlgNuevaMarca').show();" update=":nuevaMarca"
                                     />
                </h:panelGroup>
                <p:message for="marcaField"/>




                <h:outputLabel for="tipoUnidadCompraSelect" value="#{msg.productoTipoUnidadCompra}:"/>
                <p:selectOneMenu id="tipoUnidadCompraSelect" value="#{productoEditBean.productosActual.idTipoUnidadCompra}"
                                 required="true" requiredMessage="#{msg.seleccionarValor}" converter="#{productosTiposUnidadesConverter}"
                                 label="#{msg.productoTipoUnidadCompra}">

                    <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                    <f:selectItems value="#{productoEditBean.listTipoUnidades}" var="tipoUnidad" itemLabel="#{tipoUnidad.nombreUnidad}"
                                   itemValue="#{tipoUnidad}"/>
                </p:selectOneMenu>
                <p:message for="tipoUnidadCompraSelect"/>

                <h:outputLabel for="tipoUnidadVentaSelect" value="#{msg.productoTipoUnidadVenta}:"/>
                <p:selectOneMenu id="tipoUnidadVentaSelect" value="#{productoEditBean.productosActual.idTipoUnidadVenta}"
                                 required="true" requiredMessage="#{msg.seleccionarValor}" converter="#{productosTiposUnidadesConverter}"
                                 label="#{msg.productoTipoUnidadVenta}">

                    <f:selectItem noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" itemValue="#{null}"/>
                    <f:selectItems value="#{productoEditBean.listTipoUnidades}" var="tipoUnidad" itemLabel="#{tipoUnidad.nombreUnidad}"
                                   itemValue="#{tipoUnidad}"/>
                </p:selectOneMenu>
                <p:message for="tipoUnidadCompraSelect"/>


                <h:outputLabel for="costoAdquisicionField" value="#{msg.costoAdquisicion}:" />
                <p:inputText id="costoAdquisicionField" value="#{productoEditBean.productosActual.costoAdquisicionNeto}"
                             required="true" requiredMessage="#{msg.ingresarValor}"
                             label="#{msg.costoAdquisicion}"/>
                <p:message for="costoAdquisicionField"/>


                <h:outputLabel for="alicuotaIVAField" value="#{msg.alicuotaIVA}:"/>
                <p:selectOneMenu id="alicuotaIVAField" value="#{productoEditBean.productosActual.idAlicuotaIva}" required="true"
                                 requiredMessage="#{msg.seleccionarValor}" converter="#{fiscalAlicuotaIVAConverter}"
                                 label="#{msg.alicuotaIVA}">
                    <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}" />
                    <f:selectItems value="#{productoEditBean.listAlicuotaIVA}" var="alicuota"
                                   itemLabel="#{alicuota.nombreAlicuotaIva}" itemValue="#{alicuota}" />

                </p:selectOneMenu>
                <p:message for="alicuotaIVAField"/>

                <h:outputLabel for="utilidadField" value="#{msg.productosUtilidad}:"/>
                <p:inputText id="utilidadField" value="#{productoEditBean.productosActual.utilidad}"
                             label="#{msg.productosUtilidad}">
                    <f:convertNumber maxFractionDigits="2"
                                     groupingUsed="true"
                                     maxIntegerDigits="3"
                                     type="number"/>

                </p:inputText>
                <p:message for="utilidadField"/>


                <h:outputLabel for="stockField" value="#{msg.stock}:"/>
                <p:inputText id="stockField" value="#{productoEditBean.productosActual.stockTotal}" required="true"
                             requiredMessage="#{msg.ingresarValor}" >
                    <f:convertNumber  maxIntegerDigits="8"
                                      maxFractionDigits="2"/>
                </p:inputText>
                <p:message for="stockField"/>

                <h:outputLabel for="proveedorHabitualField" value="#{msg.proveedor}:"/>
                <p:selectOneMenu id="proveedorHabitualField" value="#{productoEditBean.productosActual.idProveedorHabitual}"
                                 converter="#{personasConverter}"
                                 required="false" requiredMessage="#{msg.seleccionarUno}">
                    <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                    <f:selectItems value="#{productoEditBean.listProveedores}" var="proveedor" itemLabel="#{proveedor.nombreFantasia}"
                                   itemValue="#{proveedor}"/>

                </p:selectOneMenu>
                <p:message for="proveedorHabitualField"/>


                <h:outputLabel for="tipoProveeduriaField" value="#{msg.tipoProveeduria}:"/>
                <p:selectOneMenu id="tipoProveeduriaField" value="#{productoEditBean.tiposProveeduria}"
                                 required="true" requiredMessage="#{msg.seleccionarUno}" converter="#{productosTiposProveeduriaConverter}"
                                 >
                    <f:selectItem  noSelectionOption="true" itemLabel="#{msg.seleccionarUno}"  itemValue="#{null}"/>
                    <f:selectItems value="#{productoEditBean.listTipoProveeduria}" var="tipoProd" itemLabel="#{tipoProd.nombreTipoProveeduria}"
                                   itemValue="#{tipoProd}"/>

                </p:selectOneMenu>
                <p:message for="tipoProveeduriaField"/>


                <h:outputLabel for="ubicacionField" value="#{msg.ubicacion}:"/>
                <p:inputText id="ubicacionField" value="#{productoEditBean.productosActual.ubicacion}"
                             converter="#{stringFormatConverter}"/>
                <p:message for="ubicacionField"/>



            </h:panelGrid>



            <h:panelGrid columns="2" >
                <p:commandButton id="guardarButton"
                                 value="#{msg.guardar}"
                                 icon="ui-icon-disk"
                                 action="#{productoEditBean.doGuardar}"
                                 update="@form"
                                 ajax="true"
                                 />

                <p:commandButton id="cancelarButton"
                                 value="#{msg.cancelar}"
                                 icon="ui-icon-cancel"
                                 action="/protected/productos/consultarProductos.xhtml?faces-redirect=true"
                                 immediate="true"
                                 ajax="false" />
            </h:panelGrid>
        </p:panel>
    </h:form>

    <h:form id="nuevoRubroForm">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlg2"  height="100">


            <h:panelGrid columns="3">


                <h:outputLabel for="descripcionRubroField" value="#{msg.productoRubro}:" />
                <p:inputText id="descripcionRubroField" value="#{productoEditBean.productosRubrosNuevo.nombreRubro}"
                             required="true" requiredMessage="#{msg.ingresarValor}"/>
                <p:message for="descripcionRubroField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarRubro}"
                                  update=":editProductoForm:rubroField" onclick="PF('dlg2').hide();" />



            </h:panelGrid>
        </p:dialog>
    </h:form>


    <h:form id="nuevoSubRubroForm">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlgSubRubro"  height="100">

            <h:panelGrid columns="2">

                <h:outputLabel for="descripcionRubro" value="#{msg.productoRubro}:" />
                <h:outputText  id="descripcionRubro" value="#{productoEditBean.productosSubRubrosNuevo.idRubro.nombreRubro}"
                               />
            </h:panelGrid>

            <h:panelGrid columns="3" >

                <h:outputLabel for="descripcionSubRubroField" value="#{msg.productoSubRubro}:" />
                <p:inputText id="descripcionSubRubroField" value="#{productoEditBean.productosSubRubrosNuevo.nombreSubRubro}"
                             required="true" requiredMessage="#{msg.ingresarValor}"/>
                <p:message for="descripcionSubRubroField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarSubRubro}"
                                  update=":editProductoForm:subRubroField" onclick="PF('dlgSubRubro').hide();"/>

            </h:panelGrid>
        </p:dialog>
    </h:form>

    <h:form id="nuevaMarca">
        <p:dialog modal="true" header="#{msg.nuevoRubro}" widgetVar="dlgNuevaMarca"  height="100">



            <h:panelGrid columns="3" >

                <h:outputLabel for="nombreMarcaField" value="#{msg.marca}:" />
                <p:inputText id="nombreMarcaField" value="#{productoEditBean.productosMarcas.nombreMarca}"
                             required="true" requiredMessage="#{msg.ingresarValor}"/>
                <p:message for="nombreMarcaField"/>
            </h:panelGrid>
            <h:panelGrid columns="2">
                <p:commandButton  value="#{msg.guardar}"  action="#{productoEditBean.doGuardarMarca}"
                                  update=":editProductoForm:marcaField" onclick="PF('dlgNuevaMarca').hide();"/>

            </h:panelGrid>
        </p:dialog>
    </h:form>


</html>
